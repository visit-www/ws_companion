{% extends "base.html" %}
{% block title %}Radiology Tools – WSC{% endblock %}

{% block content %}
<div class="container py-4">
  <h1 class="mb-4">Radiology Tools</h1>
  <p class="text-muted mb-4">
    Quick access to report templates, staging &amp; classification systems, imaging protocols, and normal measurements to support your daily reporting workflow.
  </p>
  <a href="{{ url_for('main_routes.index') }}" class="btn btn-light mb-3 mt-auto">
        Back to Radiologist's Dahsboard
    </a>
<!-- Filter bar -->
  <form method="get" class="card mb-4 shadow-sm">
    <div class="card-body">
      <div class="row g-3 align-items-end">
        <div class="col-12 col-md-4">
          <label for="modality" class="form-label mb-1">Modality</label>
          <select name="modality" id="modality" class="form-select">
            <option value="">All modalities</option>
            {% for m in modality_choices %}
            <option value="{{ m.name }}"
                    {% if selected_modality and selected_modality.name == m.name %}selected{% endif %}>
              {{ m.value }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-12 col-md-4">
          <label for="body_part" class="form-label mb-1">Body part / Region</label>
          <select name="body_part" id="body_part" class="form-select">
            <option value="">All body parts</option>
            {% for b in body_part_choices %}
            <option value="{{ b.name }}"
                    {% if selected_body_part and selected_body_part.name == b.name %}selected{% endif %}>
              {{ b.value }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-12 col-md-4">
          <label for="q" class="form-label mb-1">Search term</label>
          <div class="input-group">
            <input type="text" name="q" id="q" class="form-control"
                  placeholder="e.g. stroke, TI-RADS, CTPA"
                  value="{{ query or '' }}">
            <button class="btn btn-primary" type="submit">
              <i class="bi bi-search"></i> Filter
            </button>
            <a href="{{ url_for('main_routes.radiology_tools') }}"
              class="btn btn-outline-secondary">
              Reset
            </a>
          </div>
        </div>
      </div>
    </div>
  </form>

  <div class="row g-4">
    <!-- Templates column -->
    <div class="col-12 col-lg-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h4 class="card-title mb-3">Report Templates</h4>

          {% if templates %}
            <ul class="list-group list-group-flush">
              {% for t in templates %}
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="me-2">
                  <div class="fw-bold">{{ t.template_name }}</div>
                  <small class="text-muted">
                    {% if t.modality %}{{ t.modality.value }}{% endif %}
                    {% if t.body_part %} · {{ t.body_part.value }}{% endif %}
                  </small>
                </div>
                <div>
                  <a href="{{ url_for('content_routes.get_template', template_id=t.id) }}"
                    class="btn btn-sm btn-outline-primary">
                    View
                  </a>
                </div>
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">No templates match the current filters.</p>
          {% endif %}

          <div class="mt-3 text-end">
            <a href="{{ url_for('content_routes.list_templates') }}" class="btn btn-link btn-sm">
              View all templates
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Staging / classification column -->
    <div class="col-12 col-lg-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h4 class="card-title mb-3">Staging & Classification</h4>

          {% if classifications %}
            <ul class="list-group list-group-flush">
              {% for s in classifications %}
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="me-2">
                  <div class="fw-bold">{{ s.name }}</div>
                  <small class="text-muted d-block">
                    {% if s.short_code %}{{ s.short_code }} · {% endif %}
                    {% if s.category %}{{ s.category.value.replace('_', ' ').title() }} · {% endif %}
                    {% if s.modality %}{{ s.modality.value }}{% endif %}
                    {% if s.body_part %} · {{ s.body_part.value }}{% endif %}
                  </small>
                  {% if s.tags %}
                  <div class="small text-muted mt-1">
                    {{ s.tags }}
                  </div>
                  {% endif %}
                </div>
                <div>
                  <a href="{{ url_for('content_routes.get_classification_system', system_id=s.id) }}"
                    class="btn btn-sm btn-outline-primary">
                    View
                  </a>
                </div>
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">No staging systems match the current filters.</p>
          {% endif %}

          <div class="mt-3 text-end">
            <a href="{{ url_for('content_routes.list_classification_systems') }}" class="btn btn-link btn-sm">
              View all staging systems
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Protocols column -->
    <div class="col-12 col-lg-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h4 class="card-title mb-3">Imaging Protocols</h4>

          {% if protocols %}
            <ul class="list-group list-group-flush">
              {% for p in protocols %}
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="me-2">
                  <div class="fw-bold">{{ p.name }}</div>
                  <small class="text-muted">
                    {% if p.modality %}{{ p.modality.value }}{% endif %}
                    {% if p.body_part %} · {{ p.body_part.value }}{% endif %}
                    {% if p.is_emergency %} · Emergency{% endif %}
                  </small>
                </div>
                <div>
                  <a href="{{ url_for('content_routes.get_protocol', protocol_id=p.id) }}"
                    class="btn btn-sm btn-outline-primary">
                    View
                  </a>
                </div>
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">No protocols match the current filters.</p>
          {% endif %}

          <div class="mt-3 text-end">
            <a href="{{ url_for('content_routes.list_protocols') }}" class="btn btn-link btn-sm">
              View all protocols
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Normal Measurements column -->
    <div class="col-12 col-lg-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h4 class="card-title mb-3">Normal Measurements</h4>

          {% if normal_measurements %}
            <ul class="list-group list-group-flush">
              {% for nm in normal_measurements %}
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="me-2">
                  <div class="fw-bold">{{ nm.name }}</div>
                  <small class="text-muted">
                    {% if nm.modality %}{{ nm.modality.value }}{% endif %}
                    {% if nm.body_part %} · {{ nm.body_part.value }}{% endif %}
                  </small>
                </div>
                <div>
                  <a href="{{ url_for('main_routes.measurement_detail', measurement_id=nm.id) }}"
                     class="btn btn-sm btn-outline-primary">
                    View
                  </a>
                </div>
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">No normal measurements match the current filters.</p>
          {% endif %}

          <div class="mt-3 text-end">
            <a href="{{ url_for('main_routes.measurement_library') }}" class="btn btn-link btn-sm">
              View full measurements library
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}