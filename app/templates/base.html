<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TZZPBH5J6E"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-TZZPBH5J6E');
    </script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
</head>

<body>

    <!-- CSS Stylesheets -->

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Armata:wght@400&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('main_routes.static', filename='css/style.css') }}" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <title>{% block title %}Radiology Workstation Companion{% endblock %}</title>
    <!-- Include jQuery from CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    </head>

    <body>
        {% block modal %}
        <!-- Include the modal -->
        {% include 'modal_embed_code.html' %}
        {% endblock %}
        <div class="paper-background-wrapper">
            <div class="main-container">
                <!-- Navbar -->
                {% block nav_bar %}
                <nav class="navbar navbar-expand-lg navbar-light bg-light w-100">
                    <div class="container-fluid">
                        <i class="bi bi-shield-fill-check p-lg-4 p-md-4 p-sm-3 py-3"
                            style="color:rgb(12, 4, 122); font-size: 1.7em;"></i>
                        <div>
                            <div class="row gap-2">
                                <a class="navbar-brand p-md-3 p-sm-3 col-auto"
                                    href="{{ url_for('main_routes.index') }}">My
                                    Workstation Companion</a>
                            </div>
                            <div class="navbar-nav ml-auto col-12">
                                <div class="nav-item">
                                    <span class="navbar-text greeting-text text-success fw-bold animate-pulse"
                                        style="display:none" user_name="{{ current_user.username }}">
                                        Hello, {{ current_user.username }}! Your last login was on: {{ last_login }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                            aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse sm_navbar_items" id="navbarNav">
                            <ul class="navbar-nav ms-auto">
                                <li class="nav-item"><a class="nav-link"
                                        href="{{ url_for('main_routes.index') }}">Home</a>
                                </li>
                                <li class="nav-item"><a class="nav-link"
                                        href="{{ url_for('main_routes.pricing') }}">Pricing</a></li>
                                <li class="nav-item"><a class="nav-link" href="{{ url_for('main_routes.buy_now') }}">Buy
                                        Now</a></li>
                                <li class="nav-item"><a class="nav-link"
                                        href="{{ url_for('main_routes.free_trial') }}">Free
                                        Trial</a></li>
                                {% if current_user.is_authenticated %}
                                <li class="nav-item"><a class="nav-link"
                                        href="{{ url_for('app_user.logout') }}">Logout</a>
                                </li>
                                {% if current_user.is_admin %}
                                <li class="nav-item"><a class="nav-link"
                                        href="{{ url_for('app_admin.admin_dashboard') }}">Admin Access</a></li>
                                {% else %}
                                <li class="nav-item"><a class="nav-link"
                                        href="{{ url_for('app_user.user_management') }}">My
                                        Account</a></li>
                                {% endif %}
                                {% else %}
                                <li class="nav-item"><a class="nav-link"
                                        href="{{ url_for('app_user.login') }}">Login</a>
                                </li>
                                <li class="nav-item"><a class="nav-link"
                                        href="{{ url_for('app_user.register') }}">Register</a></li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </nav>
                {% endblock %}
                {% block hero_container %}
                <div class="container-fluid my-4">
                    <div class="hero-container d-flex align-items-center justify-content-center py-5 px-4 rounded shadow-sm"
                        style="background: linear-gradient(135deg, #1e1b45, #2a2f70, #3c77ff); color: #f8f9fa; position: relative; overflow: hidden;">

                        <!-- Optional Glow Overlay (Can be a blurred div or SVG if needed later) -->

                        <!-- Logo -->
                        <a class="navbar-brand me-5" href="{{ url_for('main_routes.index') }}">
                            <img src="{{ url_for('static', filename='assets/images/wsc-vertical-trans.png') }}"
                                alt="Logo" style="height: 180px;">
                        </a>

                        <!-- Hero Text Container -->
                        <div class="text-container text-center">
                            <h1 class="display-5 fw-bold mb-3" style="font-family: 'Inter', sans-serif;">
                                <span
                                    style="background: linear-gradient(90deg, #00f0ff, #ff00c8); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                                    WSC
                                </span> â€“ A Workstation Companion App
                            </h1>
                            <p class="lead mb-4" style="color: #e0e6f0;">
                                Simplify your radiology workflow with our intuitive and comprehensive tools.<br>
                                <span class="fst-italic" style="color: #00f087;">Because every hero needs a trusty
                                    companion.</span>
                            </p>


                        </div>

                    </div>
                </div>
                {% endblock %}


                <!-- Code to displace flash message -->

                <!-- ðŸ”” Toast Message Container (always present) -->
                <div aria-live="polite" aria-atomic="true" class="position-relative z-3">
                    <div class="toast-container position-fixed p-3" id="dynamic-toast-container" style="z-index: 9999;">
                        {# Render Flask flash messages if present #}
                        {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                        {% for category, message in messages %}
                        <div class="toast align-items-center text-white pastel-bg-{{ category }} border-0 fade"
                            role="alert" aria-live="assertive" aria-atomic="true"
                            data-bs-delay="{{ '999999' if category == 'danger' else '4000' }}">
                            <div class="d-flex">
                                <div class="toast-body">{{ message|safe }}</div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                    data-bs-dismiss="toast" aria-label="Close"></button>
                            </div>
                        </div>
                        {% endfor %}
                        {% endif %}
                        {% endwith %}
                    </div>
                </div>
                <!-- Content Section -->
                {% block content %}
                <!--this is placeholder for contents-->
                {% endblock %}
                <!-- This is placeholder for references-->
                {% block references %}
                <div class="references-container d-flex justify-content-start p-3">

                    {% if references %}
                    <div class="card p-3 w-100 text-start pastel-light-peach ">
                        <h2 class="card-title">References</h2>
                        <ol class="card-body text-primary">
                            {% for reference in references %}
                            <li>
                                <a href="{{ url_for('content_routes.view_reference', category=reference.category, display_name='References', reference_id=reference.id) }}"
                                    target="_blank">{{ reference.title }}</a>


                            </li>
                            {% endfor %}
                        </ol>
                    </div>
                    {% else %}
                    <div clas="d-flex justify-content-end">
                        <p class="text-muted">No references available for this page.</p>
                    </div>
                    {% endif %}
                </div>
            </div> <!-- End paper-background-wrapper -->
            {% endblock %}

            <!-- Footer -->
            {% block footer %}
            <footer class="footer mt-auto py-3 bg-light"">
                <div class=" container">
                <div class="row footer-links">
                    <div class="col-12 col-md-6 foot-contact">
                        <a href="{{ url_for('main_routes.contact_us') }}" class="contact-us">Contact us |</a>
                        <a href="{{ url_for('main_routes.review_us') }}" class="contact-us">Review us</a>
                    </div>
                    <div class="col-12 col-md-6 foot-social text-md-end">
                        <div class="contact-us">Follow us:</div>
                        <a href="https://www.instagram.com" target="_blank">
                            <img class="instagram-icon" alt="Instagram"
                                src="{{ url_for('main_routes.static', filename='assets/instagram.svg') }}">
                        </a>
                        <a href="https://www.facebook.com" target="_blank">
                            <img class="instagram-icon" alt="Facebook"
                                src="{{ url_for('main_routes.static', filename='assets/facebook.svg') }}">
                        </a>
                        <a href="https://www.twitter.com" target="_blank">
                            <img class="instagram-icon" alt="Twitter"
                                src="{{ url_for('main_routes.static', filename='assets/twitter.svg') }}">
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 text-center copyright">
                        <p>&copy; 2024 Radiology Workstation Companion. All rights reserved.</p>
                    </div>
                </div>
        </div>
        </footer>
        {% endblock %}


        </div>
        {% block script %}
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="{{ url_for('main_routes.static', filename='js/script.js') }}"></script>

        <!-- âœ… Flash Message Handler -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const messageContainer = document.querySelector('.toast-container');
                const toastElList = [].slice.call(document.querySelectorAll('.toast'));
                let hasMessage = false;

                toastElList.forEach(function (toastEl) {
                    const messageBody = toastEl.querySelector('.toast-body');
                    if (messageBody && messageBody.textContent.trim() !== '') {
                        hasMessage = true;
                        const toast = new bootstrap.Toast(toastEl, { autohide: true, delay: 5000 });
                        toast.show();
                        toastEl.addEventListener('hidden.bs.toast', function () {
                            if (!document.querySelector('.toast.show')) {
                                messageContainer.style.display = 'none';
                            }
                        });
                    }
                });

                if (hasMessage) {
                    messageContainer.style.display = 'block';
                } else {
                    messageContainer.style.display = 'none';
                }

                document.querySelectorAll('.toast-body').forEach(function (messageBody) {
                    const text = messageBody.textContent || messageBody.innerText;
                    messageBody.classList.add("text-dark");
                    if (text.includes('LOGIN FAILED')) {
                        messageBody.classList.remove("text-dark");
                        messageBody.classList.add("text-warning");
                    } else if (text.includes('LOGIN SUCCESSFUL')) {
                        messageBody.classList.remove("text-warning");
                        messageBody.classList.add("text-dark");
                    }
                });
            });
        </script>

        <!-- âœ… Idle Logout -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const idleWarningTime = 33 * 60 * 1000;
                const logoutTime = 38 * 60 * 1000;

                let warningTimeout, logoutTimeout;

                function resetTimers() {
                    clearTimeout(warningTimeout);
                    clearTimeout(logoutTimeout);
                    warningTimeout = setTimeout(showIdleWarning, idleWarningTime);
                    logoutTimeout = setTimeout(logoutUser, logoutTime);
                }

                function showIdleWarning() {
                    let countdown = 5 * 60;
                    const modal = document.createElement('div');
                    modal.id = 'idle-warning-modal';
                    modal.innerHTML = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center;">
                        <div style="background: white; padding: 20px; border-radius: 5px; text-align: center;">
                        <h4>Inactivity Warning</h4>
                        <p>You will be logged out in <span id="countdown">${countdown}</span> seconds due to inactivity.</p>
                        <button id="continue-session-btn" class="btn btn-primary">Continue Session</button>
                        </div>
                    </div>`;
                    document.body.appendChild(modal);

                    const countdownEl = document.getElementById('countdown');
                    const interval = setInterval(() => {
                        countdown--;
                        countdownEl.textContent = countdown;
                        if (countdown <= 0) {
                            clearInterval(interval);
                            logoutUser();
                        }
                    }, 1000);

                    document.getElementById('continue-session-btn').addEventListener('click', function () {
                        clearInterval(interval);
                        resetTimers();
                        modal.remove();
                    });
                }

                function logoutUser() {
                    const modal = document.getElementById('idle-warning-modal');
                    if (modal) modal.remove();
                    window.location.href = "{{ url_for('app_user.logout') }}";
                }

                function stopTimers() {
                    clearTimeout(warningTimeout);
                    clearTimeout(logoutTimeout);
                }

                document.getElementById('embedCodeModal')?.addEventListener('shown.bs.modal', stopTimers);
                document.getElementById('embedCodeModal')?.addEventListener('hidden.bs.modal', resetTimers);

                ['click', 'mousemove', 'keydown', 'scroll', 'touchstart'].forEach(event =>
                    window.addEventListener(event, () => {
                        if (!document.getElementById('embedCodeModal')?.classList.contains('show')) {
                            resetTimers();
                        }
                    })
                );

                resetTimers();
            });
        </script>

        <!-- âœ… Greeting Display -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const greeting = document.querySelector('.greeting-text');
                const userName = greeting?.getAttribute('user_name');
                if (userName) {
                    greeting.style.display = "block";
                }
            });
        </script>

        <!-- âœ… Timezone Conversion for UTC session timestamps -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {

                const userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                // Get today's date in local timezone
                const localNow = new Date();
                const sessionDate = localNow.toLocaleDateString("en-GB", {
                    timeZone: userTimeZone,
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

                // Inject into DOM
                const todayDateElement = document.getElementById("today-date");
                if (todayDateElement) {
                    todayDateElement.innerText = sessionDate;
                }
                const formatOptions = {
                    timeZone: userTimeZone,
                    year: 'numeric', month: 'short', day: 'numeric',
                    hour: '2-digit', minute: '2-digit', second: '2-digit'
                };
                document.querySelectorAll(".session-start, .session-end").forEach(function (el) {
                    const utc = el.dataset.utc;
                    if (utc) {
                        el.textContent = new Date(utc).toLocaleString('en-IN', formatOptions);
                    }
                });
            });
        </script>
        <!-- âœ… Define showToast as standalone function -->
        <script>
            function showToast(message, bgClass = 'bg-success', positionClass = 'bottom-0 end-0') {
                const toastContainer = document.getElementById('dynamic-toast-container');
                toastContainer.className = `toast-container position-fixed ${positionClass} p-3`;

                const toastEl = document.createElement('div');
                toastEl.className = `toast align-items-center text-white ${bgClass} border-0 show`;
                toastEl.setAttribute('role', 'alert');
                toastEl.setAttribute('aria-live', 'assertive');
                toastEl.setAttribute('aria-atomic', 'true');
                toastEl.setAttribute('data-bs-delay', '4000');

                toastEl.innerHTML = `
                    <div class="d-flex">
                        <div class="toast-body">${message}</div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>`;

                toastContainer.appendChild(toastEl);
                const bsToast = new bootstrap.Toast(toastEl);
                bsToast.show();
                toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());
            }
        </script>
        {% endblock %}
    </body>

</html>