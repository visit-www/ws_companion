

{% extends "base.html" %}

{% block title %}Developer Roadmap – Case Workspace (Radiologist Co‑Pilot){% endblock %}

{% block content %}
<div class="container mt-4 protocol-rich-text">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="mb-0">Developer Roadmap – Case Workspace</h1>
    </div>

    <p class="lead">
        This page documents how WSCompanion should function as a true “co‑pilot” for a radiologist working through a single case,
        from opening images to signing the report and reflecting on learning. Treat this as the functional blueprint for the
        <strong>Case Workspace</strong> module.
    </p>

    <div class="row mt-4">
        <!-- Left: Section navigation -->
        <div class="col-lg-3 mb-4">
            <div class="card shadow-sm sticky-top" style="top: 80px;">
                <div class="card-header">
                    <strong>Workflow Sections</strong>
                </div>
                <div class="list-group list-group-flush">
                    <a class="list-group-item list-group-item-action" href="#phase-roadmap">
                        0. Phase Roadmap
                    </a>
                    <a class="list-group-item list-group-item-action" href="#section-1">
                        1. Clinical Question Panel
                    </a>
                    <a class="list-group-item list-group-item-action" href="#section-2">
                        2. Pattern &amp; DDX Helper
                    </a>
                    <a class="list-group-item list-group-item-action" href="#section-3">
                        3. Measurement Smart Assist
                    </a>
                    <a class="list-group-item list-group-item-action" href="#section-4">
                        4. Diagnosis Companion
                    </a>
                    <a class="list-group-item list-group-item-action" href="#section-5">
                        5. Report Checklist by Indication
                    </a>
                    <a class="list-group-item list-group-item-action" href="#section-6">
                        6. Conclusion Wizard
                    </a>
                    <a class="list-group-item list-group-item-action" href="#section-7">
                        7. Learning &amp; Analytics
                    </a>
                    <a class="list-group-item list-group-item-action" href="#section-8">
                        8. How It Fits in WSCompanion
                    </a>
                    <a class="list-group-item list-group-item-action" href="#section-9">
                        9. How to use this roadmap with ChatGpt
                    </a>
                </div>
            </div>
        </div>

        <!-- Right: Detailed content -->
        <div class="col-lg-9">

            <!-- Phase Roadmap Overview -->
            <section id="phase-roadmap" class="mb-4">
                <div class="card shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="h4 mb-0">0. Phase Roadmap – Case Workspace &amp; Beyond</h2>
                            <small class="text-muted">High-level phases for WSCompanion reporting evolution.</small>
                        </div>
                        <span class="badge bg-primary-subtle text-primary border border-primary-subtle">
                            Living document
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <h3 class="h6 mb-1">Phase 2 – Case Workspace</h3>
                            <p class="small mb-2">
                                Turn WSCompanion into a practical, case-centric co‑pilot for day-to-day radiology reporting.
                            </p>
                            <ul class="small mb-0">
                                <li>
                                    <strong>Phase 2a – Core reporting loop</strong>
                                    <span class="badge bg-success ms-1">Completed</span><br>
                                    Report template (Admin/User) populates the Case Workspace textarea, user can save
                                    <code>UserReportInstance</code>, and templates open in their dedicated viewers.
                                </li>
                                <li class="mt-2">
                                    <strong>Phase 2b – Enhanced Case Workspace editor UI</strong><br>
                                    Upgrade the textarea to behave like <code>smart_report_viewer</code> /
                                    Smart Report dashboard (see <code>create_smart_report</code> routes in
                                    <code>user_routes.py</code>), reusing the same structure and UX patterns.
                                </li>
                                <li class="mt-2">
                                    <strong>Phase 2c – Interactive helpers</strong><br>
                                    Add interactive Case Workspace helpers wired through a unified suggestion pipeline: autosuggestions for measurements,
                                    diagnosis labels and phrases, and context-aware helper panels driven by modality, body part, and core clinical question,
                                    all operating on the canonical plain-text report representation.
                                </li>
                                <li class="mt-2">
                                    <strong>Phase 2d – Re-open saved reports</strong><br>
                                    Allow a <code>UserReportInstance</code> to be reopened inside Case Workspace with its original
                                    template context, and provide dedicated report viewers for reviewing past reports.
                                </li>
                            </ul>
                        </div>

                        <div class="mb-3">
                            <h3 class="h6 mb-1">Phase 3 – Teaching File &amp; Personal Case Library</h3>
                            <p class="small mb-0">
                                Build a Teaching File / personal case library module where de-identified cases, key images,
                                measurements and final reports can be saved and reused for academic teaching, viva preparation,
                                and personal learning. Integrate tightly with Case Workspace so interesting cases can be promoted
                                to Teaching Files with one click, and allow the Teaching File corpus to act as an additional knowledge
                                source feeding the same suggestion pipeline used by the Case Workspace helpers.
                            </p>
                        </div>

                        <div>
                            <h3 class="h6 mb-1">Phase 4 – AI Functionality</h3>
                            <p class="small mb-0">
                                Layer assistive AI features onto the established workflow as a final tier in the same helper pipeline:
                                AI-assisted autosuggestions in Case Workspace (when local history and playbooks are insufficient),
                                AI parsing of pasted reports into structured sections, and AI support within Teaching Files
                                (case summaries, quiz generation, viva-style Q&amp;A), always with deterministic fallbacks and
                                always respecting radiologist control and clinical safety.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 1 -->
            <section id="section-1" class="mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h2 class="h4 mb-0">1. Case opened → “Clinical Question Panel”</h2>
                    </div>
                    <div class="card-body">
                        <h5>Where you are in workflow</h5>
                        <p>
                            The radiologist has just opened the case, read the clinical history, and is about to start scrolling through images.
                        </p>

                        <h5>Pain points</h5>
                        <ul>
                            <li>History is often vague or messy.</li>
                            <li>Hard to keep the core question in mind while getting lost in images.</li>
                        </ul>

                        <h5>What WSCompanion should do</h5>
                        <h6>1.1 Quick “Clinical Question” capture</h6>
                        <p>
                            On the <strong>Case Workspace</strong> page, provide a simple “Clinical Question Panel” with:
                        </p>
                        <ul>
                            <li><strong>Indication</strong> (free text / dropdown).</li>
                            <li><strong>Suspected body part + modality</strong> (e.g. CT chest, MRI brain).</li>
                            <li><strong>Core question</strong> (e.g. “?PE”, “?HCC characterization”, “?acute stroke”).</li>
                        </ul>

                        <p>Use these inputs to auto-suggest:</p>
                        <ul>
                            <li>Relevant imaging protocol(s).</li>
                            <li>Relevant report template.</li>
                            <li>Relevant checklist (e.g. “For ?PE you must mention…”).</li>
                        </ul>

                        <p class="mb-0">
                            <strong>Effect:</strong> This fixes the clinical anchor right at the start so every later tool in the workspace is tailored to
                            the actual clinical question.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Section 2 -->
            <section id="section-2" class="mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h2 class="h4 mb-0">2. Scrolling images → “Pattern &amp; DDX helper”</h2>
                    </div>
                    <div class="card-body">
                        <h5>Where you are</h5>
                        <p>
                            The radiologist is scrolling through slices and thinking:
                            <em>“What on earth is this pattern?”</em>
                        </p>

                        <h5>Pain points</h5>
                        <ul>
                            <li>Pattern-based thinking (tree-in-bud, ground glass, ring-enhancing) is often in the radiologist’s head or scattered PDFs.</li>
                            <li>Time is wasted googling or digging through Radiopaedia / textbooks during a busy list.</li>
                        </ul>

                        <h5>What WSCompanion should do</h5>
                        <h6>2.1 Pattern-based DDX search</h6>
                        <p>Add a “Finding → DDX” tab within the Case Workspace:</p>
                        <ul>
                            <li>Inputs:
                                <ul>
                                    <li>Modality.</li>
                                    <li>Body part.</li>
                                    <li>Visual pattern (dropdown + free text) such as “ring-enhancing lesion”, “crazy paving”, “restricting extra-axial mass”.</li>
                                </ul>
                            </li>
                            <li>Output: a card list of differentials with:
                                <ul>
                                    <li>Top differentials ranked (common first, critical first).</li>
                                    <li>Key imaging clues <em>for</em> each diagnosis.</li>
                                    <li>Key clues <em>against</em> each diagnosis.</li>
                                    <li>“Red flag” / must-not-miss notes.</li>
                                </ul>
                            </li>
                        </ul>

                        <p class="mb-0">
                            Under the hood, this can sit on top of existing <strong>Classification</strong>/Content models, structured as
                            <em>pattern → DDX content</em>.
                            <br>
                            <strong>Effect:</strong> when stuck on appearance, WSCompanion becomes a pattern library living right next to PACS.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Section 3 -->
            <section id="section-3" class="mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h2 class="h4 mb-0">3. Needing measurements → “Measurement Smart Assist”</h2>
                    </div>
                    <div class="card-body">
                        <h5>Where you are</h5>
                        <p>
                            The radiologist has spotted a finding and is now measuring structures – CBD, aortic diameter, canal stenosis, lesion size, etc.
                        </p>

                        <h5>Pain points</h5>
                        <ul>
                            <li>Normal ranges are scattered in random PDFs/books.</li>
                            <li>It’s easy to forget which range applies (age, sex, paediatric vs adult).</li>
                        </ul>

                        <h5>What WSCompanion should do</h5>
                        <h6>3.1 Quick “What’s normal here?” lookup</h6>
                        <p>
                            Integrate the existing <strong>NormalMeasurement</strong> module directly into the Case Workspace via a “Measurements” tab:
                        </p>
                        <ul>
                            <li>Filter by body part + modality + age group (adult / paeds / pregnancy).</li>
                            <li>Show a list of common measurements for that region (e.g. for “Liver CT”: portal vein, CBD, liver span).</li>
                            <li>Each line displays:
                                <ul>
                                    <li>Name.</li>
                                    <li>Normal range.</li>
                                    <li>Short “how to measure” description.</li>
                                    <li>Reference.</li>
                                </ul>
                            </li>
                        </ul>

                        <h6>3.2 Smart phrase generator</h6>
                        <p>
                            Next to each measurement:
                        </p>
                        <ul>
                            <li>Input box to enter the measured value.</li>
                            <li>Button to auto-generate a phrase, e.g.
                                <em>“CBD measures 9 mm (upper normal limit up to 7 mm in this context) – mildly dilated.”</em>
                            </li>
                            <li>Ability to copy to clipboard or auto-insert into the open report template.</li>
                        </ul>

                        <p class="mb-0">
                            <strong>Effect:</strong> “What’s normal again?” becomes a one-click, contextual, well-phrased helper instead of a separate hunt.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Section 4 -->
            <section id="section-4" class="mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h2 class="h4 mb-0">4. Provisional diagnosis → “Diagnosis Companion”</h2>
                    </div>
                    <div class="card-body">
                        <h5>Where you are</h5>
                        <p>
                            The radiologist has a working diagnosis in mind (e.g. “this looks like HCC”, “probably vestibular schwannoma”, “likely PE”).
                        </p>

                        <h5>Pain points</h5>
                        <ul>
                            <li>Uncertainty about which differentials to explicitly name for this diagnosis.</li>
                            <li>Remembering which imaging features strongly support vs argue against it.</li>
                            <li>Recalling what staging or classification applies.</li>
                        </ul>

                        <h5>What WSCompanion should do</h5>
                        <h6>4.1 Diagnosis card view</h6>
                        <p>Within a “Diagnosis” tab in the workspace:</p>
                        <ul>
                            <li>The user selects or types their working diagnosis.</li>
                            <li>WSCompanion pulls a <strong>Diagnosis Card</strong> that includes:
                                <ul>
                                    <li>Key differentials for that diagnosis (each with a short 1‑line distinguishing feature).</li>
                                    <li>Essential imaging features to check (capsule, washout, MVI risk factors, perineural spread, etc.).</li>
                                    <li>Buttons for staging / classification systems (e.g. LI‑RADS, TNM, Bosniak) that open in an overlay.</li>
                                    <li>Common pitfalls (“don’t mislabel X as Y”, “beware artifact”).</li>
                                </ul>
                            </li>
                        </ul>

                        <p class="mb-0">
                            <strong>Effect:</strong> Once a likely diagnosis is named, the app prompts:
                            <em>“If you think it’s this, here is the structured mental checklist + ddx you must walk through.”</em>
                        </p>
                    </div>
                </div>
            </section>

            <!-- Section 5 -->
            <section id="section-5" class="mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h2 class="h4 mb-0">5. Ensuring clinical usefulness → “Report Checklist by Indication”</h2>
                    </div>
                    <div class="card-body">
                        <h5>Where you are</h5>
                        <p>
                            The radiologist is constructing the main report body.
                        </p>

                        <h5>Pain points</h5>
                        <ul>
                            <li>Risk of missing clinically critical information (e.g. in rectal cancer: mesorectal fascia, CRM, nodal burden, EMVI).</li>
                            <li>Guidelines differ by indication and are hard to remember in full during a busy session.</li>
                        </ul>

                        <h5>What WSCompanion should do</h5>
                        <h6>5.1 Indication-specific checklists</h6>
                        <p>
                            Because the Case Workspace already knows the indication from Step 1, it can generate
                            a <strong>“Must report” checklist</strong> for that combination of modality + body part + question:
                        </p>
                        <ul>
                            <li>Structured bullet list that can be ticked off:
                                <ul>
                                    <li>Tumour size &amp; location.</li>
                                    <li>Invasion into adjacent structures.</li>
                                    <li>Key measurements (e.g. distance to anal verge).</li>
                                    <li>Staging features.</li>
                                    <li>Complications (abscess, perforation, aneurysm, etc.).</li>
                                </ul>
                            </li>
                            <li>Optional ability to auto-insert a mini structured section into the report template.</li>
                        </ul>

                        <p class="mb-0">
                            <strong>Effect:</strong> Clinically relevant content is not left to chance; the app acts as a
                            safety net between the report and the MDT.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Section 6 -->
            <section id="section-6" class="mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h2 class="h4 mb-0">6. Writing the conclusion → “Conclusion Wizard”</h2>
                    </div>
                    <div class="card-body">
                        <h5>Where you are</h5>
                        <p>
                            The body of the report is complete; now it’s time for impression and recommendations.
                        </p>

                        <h5>Pain points</h5>
                        <ul>
                            <li>Balancing certainty vs doubt in wording.</li>
                            <li>Translating imaging into actionable recommendations (follow-up, MDT, alternative imaging).</li>
                            <li>Avoiding overly vague or purely defensive language.</li>
                        </ul>

                        <h5>What WSCompanion should do</h5>
                        <h6>6.1 Simple “Impression Builder”</h6>
                        <p>Provide a small structured form within an “Impression” tab:</p>
                        <ul>
                            <li>Diagnostic certainty slider (Definite / Probable / Possible / Uncertain).</li>
                            <li>Main diagnosis text box.</li>
                            <li>Optional top differentials (1–3) ranked.</li>
                            <li>Key complications – present or excluded – as toggles or checkboxes.</li>
                        </ul>

                        <p>
                            The app outputs an impression paragraph along the lines of:
                        </p>
                        <blockquote class="blockquote">
                            Findings are most in keeping with [Diagnosis], with [brief justification].<br>
                            Differential considerations include [Dx2, Dx3], [with/without] features to strongly suggest alternative diagnosis.
                        </blockquote>

                        <h6>6.2 Recommendation snippets</h6>
                        <p>
                            Based on diagnosis + indication, WSCompanion offers recommendation templates, for example:
                        </p>
                        <ul>
                            <li>“Discuss at MDT; correlate with alpha-fetoprotein and liver function; consider surgical/hepatology opinion.”</li>
                            <li>“Recommend CT pulmonary angiography if clinical suspicion for PE remains high.”</li>
                            <li>“Short-term follow-up MRI in 3–6 months to assess lesion stability is advised.”</li>
                        </ul>

                        <p class="mb-0">
                            The user can choose and edit these snippets, then insert them into the report.
                            <br>
                            <strong>Effect:</strong> The last few lines of the report become more consistent, clear, and clinically actionable.
                        </p>

                        <h6>6.3 Contextual smart helpers – example workflow for ?PE</h6>
                        <p>
                            The smart helper engine should support the radiologist throughout the Phase 2 reporting loop using simple,
                            contextual overlays rather than a heavy editor. The following infographic-style walkthrough assumes a case
                            of shortness of breath with suspected pulmonary embolism (<code>?PE</code>), and shows how helpers appear at each
                            stage of the report:
                        </p>
                        <ol class="small">
                            <li>
                                <strong>Indication section – clinical scores &amp; rules</strong>
                                <ul>
                                    <li>User enters: “SOB, pleuritic chest pain, Wells score 6, ?PE”.</li>
                                    <li>Action: selects the words “Wells score” and clicks a small “Smart helper” button next to the Indication textarea (or uses a shortcut).</li>
                                    <li>Helper overlay shows:
                                        <ul>
                                            <li>A <strong>Score summary card</strong> for Wells score for PE – brief description, cut‑off values, interpretation (e.g. PE likely/unlikely).</li>
                                            <li>Optional actions:
                                                <ul>
                                                    <li>“Insert short Wells summary into report” – inserts a concise sentence in the Indication section.</li>
                                                    <li>“Open full criteria” – opens a guideline/score reference in a side panel.</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <strong>Core question – tool bundle for the clinical question</strong>
                                <ul>
                                    <li>Core question already captured in Phase 1: “?PE”.</li>
                                    <li>Action: with caret in the Core question field, user clicks the same “Smart helper” control.</li>
                                    <li>Helper overlay shows a <strong>PE toolkit card</strong> that bundles:
                                        <ul>
                                            <li>Relevant imaging protocol(s) (e.g. CTPA protocol).</li>
                                            <li>Relevant report templates (admin + user) for CTPA / PE studies.</li>
                                            <li>Linked checklists (e.g. “For ?PE you must mention RV/LV ratio, alternative diagnoses, etc.”).</li>
                                            <li>Relevant classification/score aids (e.g. severity/RV strain notes).</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <strong>Comparison section – date helpers</strong>
                                <ul>
                                    <li>Text: “Compared to study dated: ____”.</li>
                                    <li>Action: user clicks “Smart helper” while caret is in the Comparison field.</li>
                                    <li>Helper overlay shows:
                                        <ul>
                                            <li>A small date helper card, allowing quick insertion of a normalised date format.</li>
                                            <li>Optional phrasing snippets:
                                                <ul>
                                                    <li>“Compared with CTPA performed on DD/MM/YYYY.”</li>
                                                    <li>“No prior imaging available for comparison.”</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <strong>Technique section – protocol-driven assistance</strong>
                                <ul>
                                    <li>Technique paragraph is present in the template (e.g. standard CTPA wording).</li>
                                    <li>Action: user clicks “Smart helper” in the Technique field.</li>
                                    <li>Helper overlay shows:
                                        <ul>
                                            <li>An <strong>Imaging protocol card</strong> for CT pulmonary angiography derived from the <code>ImagingProtocol</code> model.</li>
                                            <li>Key details (contrast type, volume, rate, phases, coverage) with a one-click option to:
                                                <ul>
                                                    <li>“Insert standard technique paragraph” (replace current Technique text).</li>
                                                    <li>“Insert as bullet list” if desired.</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <strong>Observations / Findings – measurements, checklists &amp; staging</strong>
                                <ul>
                                    <li>User types findings, e.g. “Main pulmonary arteries opacified, no definite filling defect. RV appears enlarged…”.</li>
                                    <li>Action: selects a term such as “RV enlarged” or “main pulmonary artery” and clicks “Smart helper”.</li>
                                    <li>Helper overlay shows:
                                        <ul>
                                            <li><strong>Measurement cards</strong> from the <code>NormalMeasurement</code> module (e.g. normal PA diameter, RV/LV ratio thresholds).</li>
                                            <li><strong>Checklist cards</strong> of “things not to forget” for PE reports (RV strain, alternative diagnoses, pleural effusions, etc.).</li>
                                            <li><strong>Classification/staging cards</strong> if applicable (e.g. right heart strain criteria), but <em>not</em> full templates or imaging protocols in this section.</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <strong>Conclusion / Impression – diagnosis &amp; differential sentences</strong>
                                <ul>
                                    <li>User navigates to the Conclusion/Impression section and clicks a dedicated “Diagnosis suggestions” button (the Phase 2c control).</li>
                                    <li>The backend <code>build_smart_diagnosis_suggestions</code> helper aggregates:
                                        <ul>
                                            <li>Personal history (<code>UserReportInstance</code> diagnoses).</li>
                                            <li>Templates and Teaching Files (when available).</li>
                                            <li>Static PE playbook entries (e.g. “No CT evidence of acute PE”).</li>
                                        </ul>
                                    </li>
                                    <li>Helper overlay shows:
                                        <ul>
                                            <li>Candidate <strong>diagnosis sentences</strong> such as:
                                                <ul>
                                                    <li>“No CT evidence of acute pulmonary embolism.”</li>
                                                    <li>“Acute bilateral pulmonary emboli with CT features of right heart strain.”</li>
                                                </ul>
                                            </li>
                                            <li>Optional <strong>differential diagnosis snippets</strong> based on pattern / DDX helpers.</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <strong>Recommendations – actionable follow‑up snippets</strong>
                                <ul>
                                    <li>In the Recommendations section, clicking “Smart helper” surfaces context‑aware recommendation cards, for example:
                                        <ul>
                                            <li>“Recommend initiation of anticoagulation as per local protocol and appropriate clinical follow‑up.”</li>
                                            <li>“No imaging follow‑up required solely for PE; advise follow‑up based on clinical course and risk profile.”</li>
                                        </ul>
                                    </li>
                                    <li>Each recommendation is inserted as editable text so the radiologist retains full control.</li>
                                </ul>
                            </li>
                        </ol>
                        <p class="small">
                            In all sections, the helper remains a lightweight overlay on top of the plain‑text editor: the radiologist can
                            select a word or phrase, press a single helper control or shortcut, review 1–3 concise helper cards, and insert
                            only the text they consider appropriate. This keeps the workspace fast, minimally intrusive, and aligned with
                            real on‑call reporting behaviour.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Section 7 -->
            <section id="section-7" class="mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h2 class="h4 mb-0">7. After sign‑off → “Learning &amp; Analytics”</h2>
                    </div>
                    <div class="card-body">
                        <h5>Where you are</h5>
                        <p>
                            The case is done and signed off; the radiologist moves on to the next study.
                        </p>

                        <h5>Pain points</h5>
                        <ul>
                            <li>Great cases disappear into the ether.</li>
                            <li>Hard to track what is being seen and what is being learned.</li>
                            <li>No clear pattern recognition around fatigue or performance over time.</li>
                        </ul>

                        <h5>What WSCompanion should do</h5>
                        <h6>7.1 One-click “Save as Teaching Case / Bookmark”</h6>
                        <p>
                            At the end of the case, provide a button:
                            <strong>“Mark as interesting / teaching”</strong>.
                        </p>
                        <ul>
                            <li>Store indication, diagnosis, modality, body part, and key tags.</li>
                            <li>Optionally link to the external case location (if allowed) or keep it as a conceptual teaching slot.</li>
                            <li>Later, a future <strong>TeachingFile</strong> module can surface these for viva practice.</li>
                        </ul>

                        <h6>7.2 Productivity + reflection log</h6>
                        <p>
                            Tie into the existing session tracking:
                        </p>
                        <ul>
                            <li>Automatically log time spent (start to finish), modality, body part, workplace.</li>
                            <li>Allow a subjective difficulty rating (1–5, optional).</li>
                        </ul>
                        <p>
                            At the end of the day, show a brief summary:
                        </p>
                        <ul>
                            <li>Cases by modality.</li>
                            <li>Any flagged “tricky” or “teaching” cases.</li>
                            <li>Optional 1‑line reflection, e.g. “today I struggled with X pattern”.</li>
                        </ul>

                        <p class="mb-0">
                            <strong>Effect:</strong> WSCompanion becomes both a <em>logbook</em> and a <em>learning diary</em>.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Section 8 -->
            <section id="section-8" class="mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h2 class="h4 mb-0">8. How this fits practically into WSCompanion</h2>
                    </div>
                    <div class="card-body">
                        <p>
                            To keep implementation realistic and incremental, the Case Workspace should be designed as a single,
                            central screen that lives alongside PACS and reuses as much existing infrastructure as possible.
                        </p>

                        <h5>Core screen</h5>
                        <ul>
                            <li>Route: <code>/case_workspace</code>.</li>
                            <li>Accepts query parameters: <code>modality</code>, <code>body_part</code>, <code>indication</code>.</li>
                            <li>Tabs/sections:
                                <ul>
                                    <li>Clinical.</li>
                                    <li>Findings/DDX.</li>
                                    <li>Measurements.</li>
                                    <li>Diagnosis.</li>
                                    <li>Checklist.</li>
                                    <li>Impression.</li>
                                    <li>Notes / Reflection.</li>
                                </ul>
                            </li>
                        </ul>

                        <h5>Backed by existing models</h5>
                        <ul>
                            <li>Protocols.</li>
                            <li>Classification systems.</li>
                            <li>NormalMeasurement.</li>
                            <li>Templates (admin + user).</li>
                            <li>Generic Content items (links, embeds, guidelines).</li>
                        </ul>

                        <h5>New entities to introduce</h5>
                        <ul>
                            <li><strong>FindingPattern</strong> – to model pattern → ddx links.</li>
                            <li><strong>DiagnosisGuide</strong> – to store diagnosis-centric DDX, key features, and staging pointers.</li>
                            <li><strong>TeachingFileCase</strong> (later) – for teaching case metadata and links.</li>
                            <li><strong>SmartHelperCard</strong> – database-backed model for contextual helper cards (scores, toolkits, measurements, checklists, diagnosis sentences) manageable via Flask-Admin.</li>
                        </ul>

                        <h5>UX principles</h5>
                        <ul>
                            <li>Keep it lightweight – mostly lookup and phrase insertion, not heavy data entry.</li>
                            <li>Think “second monitor” behaviour – WSCompanion on a laptop or side screen, PACS on main monitors.</li>
                            <li>Minimise clicks:
                                <ul>
                                    <li>Use keyboard shortcuts where possible.</li>
                                    <li>Enable quick copy/insert for all generated phrases and checklists.</li>
                                </ul>
                            </li>
                        </ul>

                        <h5>Helper architecture &amp; editor philosophy</h5>
                        <p>
                            Interactive helpers across Phases 2c, 3 and 4 should share a single architecture: a unified suggestion
                            pipeline that operates on a canonical plain-text report representation and can aggregate suggestions
                            from multiple tiers (local history, static playbooks, Teaching Files, and optional AI). The text editor
                            remains a simple textarea in early phases, with rich exports (DOCX/PDF) and optional rich editors layered
                            on top later, without changing the underlying helper contract.
                        </p>
                        <ul>
                            <li>Case Workspace helpers call backend endpoints that accept structured case context and the current plain-text report, and return suggestion lists or text patches.</li>
                            <li>Each endpoint aggregates suggestions from deterministic sources first (user history, templates, Teaching Files, static playbooks), only calling AI as a final tier when needed.</li>
                            <li>The frontend treats helper responses uniformly, so new sources (e.g. Teaching Files or AI) can be added without changing the Case Workspace UI.</li>
                        </ul>

                        <h5>Smart helper content model &amp; admin workflow</h5>
                        <p>
                            Smart helper content (scores, toolkits, measurements, checklists, diagnosis sentences) should gradually
                            move from hard-coded Python playbooks into a dedicated <code>SmartHelperCard</code> model so non-developers
                            can manage it via Flask-Admin, similar to protocols, templates and measurements.
                        </p>
                        <ul>
                            <li><code>SmartHelperCard</code> stores which section and token it applies to (e.g. <code>section='indication'</code>, <code>token='wells'</code>), optional filters for modality/body part/module, and card metadata such as <code>kind</code>, <code>title</code>, <code>summary</code>, <code>bullets_json</code> and <code>insert_options_json</code>, plus tags, priority and an <code>is_active</code> flag.</li>
                            <li>The smart helper engine should first query the database for matching cards and only fall back to the small static Python playbooks when no database cards exist, keeping the code as a bootstrap/fallback layer.</li>
                            <li>Over time, diagnosis helpers for the Conclusion/Impression section should also be expressed as <code>SmartHelperCard</code> entries (e.g. <code>section='conclusion'</code>, <code>kind='DIAGNOSIS_SENTENCE'</code>), so all contextual helpers share a single content system with an admin-friendly editing surface.</li>
                        </ul>

                        <p class="mb-0">
                            This section should stay up to date as the Case Workspace is implemented, serving as the
                            live functional spec for how WSCompanion supports radiologists at every step of a case.
                        </p>
                    </div>
                </div>
            </section>
            <section id="section-9" class="mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h2 class="h4 mb-0">9. How to use this roadmap with ChatGPT</h2>
                    </div>
                    <div class="card-body">
                        <p>
                            This section explains how you should interact with ChatGPT when working on WSCompanion so that
                            all development stays aligned with this roadmap and the Case Workspace vision.
                        </p>

                        <h5>Core rule</h5>
                        <p>
                            Whenever you ask ChatGPT for development help on WSCompanion, explicitly tell it to
                            <strong>use this roadmap as the single source of truth for feature priorities and design</strong>.
                        </p>

                        <h5>Suggested workflow with ChatGPT</h5>
                        <ol>
                            <li>
                                <strong>Pick a roadmap section.</strong><br>
                                Before you start a dev session, decide which part of the workflow you want to advance
                                (e.g. Section 3 – Measurement Smart Assist, or Section 5 – Report Checklist by Indication).
                            </li>
                            <li>
                                <strong>Tell ChatGPT which section you are focusing on.</strong><br>
                                Begin your prompt with something like:
                                <em>“For WSCompanion, using the Case Workspace roadmap, focus on Section 3 (Measurement Smart Assist)
                                and help me design the models/routes/templates/Micro‑UI for it.”</em>
                            </li>
                            <li>
                                <strong>Ask for concrete, implementation‑ready output.</strong><br>
                                Favour prompts that request:
                                <ul>
                                    <li>Specific SQLAlchemy models and relationships.</li>
                                    <li>Flask routes and view/controller logic.</li>
                                    <li>Jinja template structure and Bootstrap layout.</li>
                                    <li>How to integrate with existing models like <code>NormalMeasurement</code>, <code>Template</code>, etc.</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Keep scope tight.</strong><br>
                                Ask for one thin slice at a time (e.g. “just the API endpoint and service layer for pattern → DDX search”)
                                so you can implement and test incrementally.
                            </li>
                            <li>
                                <strong>Iterate based on real code.</strong><br>
                                After you paste code or errors from your editor, ask ChatGPT to revise the design
                                <em>while still honouring this roadmap</em>, rather than introducing unrelated features.
                            </li>
                        </ol>

                        <h5>Example prompts you can reuse</h5>
                        <ul>
                            <li>
                                <em>“Using the WSCompanion Case Workspace roadmap (Section 1 – Clinical Question Panel),
                                help me design the /case_workspace route signature and the initial Jinja template skeleton.”</em>
                            </li>
                            <li>
                                <em>“According to the roadmap’s Section 4 – Diagnosis Companion, suggest a SQLAlchemy model for DiagnosisGuide
                                and how it should link to ClassificationSystem and Content.”</em>
                            </li>
                            <li>
                                <em>“From Section 6 – Conclusion Wizard, generate Jinja form components and Bootstrap layout for the Impression tab,
                                assuming we already have a CaseWorkspace context object.”</em>
                            </li>
                            <li>
                                <em>“Using Sections 3 and 5 together, show how to wire the Measurement Smart Assist and Indication‑Specific Checklist
                                into a single Case Workspace page with tabs.”</em>
                            </li>
                        </ul>

                        <h5>What ChatGPT should avoid unless you explicitly request it</h5>
                        <ul>
                            <li>Designing new modules or big features that are not reflected in this roadmap.</li>
                            <li>Re‑architecting the app away from the Case Workspace concept.</li>
                            <li>Over‑complicating UX beyond the lightweight, second‑monitor usage described here.</li>
                        </ul>

                        <p class="mb-0">
                            As long as you remind ChatGPT that this roadmap is the reference for WSCompanion, it will keep
                            suggestions tightly aligned with the Case Workspace vision and your real radiologist workflow.
                        </p>
                    </div>
                </div>
            </section>

        </div>
    </div>
</div>
{% endblock %}