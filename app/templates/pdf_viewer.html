{% extends "base.html" %}

{% block title %}Document Viewer - Radiology Workstation Companion{% endblock %}

{% block hero_container %}
<div class="hero-container text-center my-4">
    <h1 class="display-4">Radiology Workstation Companion App E-Reader</h1>
</div>
{% endblock %}
{%block content %}
<!-- Custom toolbar for pdf viewer-->
<div class="container my-4">
    <div class="d-flex justify-content-around align-items-center border p-2">
        <!-- Multiple Buttons Evenly Distributed -->
        <button type="button" class="btn btn-outline-primary" id="enable_editing" editing="'not_allowed" >Button 1</button>
        <a href="{{ url_for('content_routes.view_category', display_name=display_name, category=cat) }}" class="btn btn-primary">Back to {{cat|upper}}</a>
        <button type="button" class="btn btn-outline-secondary">Button 2</button>
    </div>
<!-- Custom toolbar ends-->
<!-- Adobe DC View Container starts -->
<div id="adobe-dc-view"></div>
</div>
<!-- Adobe DC View Container ends -->

<script src="https://acrobatservices.adobe.com/view-sdk/viewer.js"></script>
<script type="text/javascript">
    var readOnly = false; // Initialize the variable to true
    // Function to update Adobe view
    function updateAdobeView() {
        var adobeDCView = new AdobeDC.View({clientId: "a5f8e2d3a4ba4c2885e1b8ac26d38a78", divId: "adobe-dc-view"});
        
        // Pass your parameters from Jinja templating
        var fileUrl = '{{file_url}}';
        var fileName = "{{file_name}}";
        var id = '{{doc.id}}';
        
        adobeDCView.previewFile({
            content: {location: {url: fileUrl}},
            metaData: {
                fileName: fileName, 
                id: id,
                hasReadOnlyAccess: readOnly
            }
        }, {
            defaultViewMode: "FIT_WIDTH", 
            showDownloadPDF: false, 
            showPrintPDF: false
        });
    }
    // Initial load of Adobe view
    document.addEventListener("adobe_dc_view_sdk.ready", function() {
        updateAdobeView();
    });
    
    // Function to toggle readOnly and update the button appearance
    function toggleEditing() {
        var button = document.getElementById("enable_editing");
        if (button.getAttribute('editing') === "not_allowed") {
            button.setAttribute('editing', "allowed");
            readOnly = false;
            button.classList.add("btn-primary");
            button.classList.remove("btn-outline-primary");
        } else {
            button.setAttribute('editing', "not_allowed");
            readOnly = true;
            button.classList.add("btn-outline-primary");
            button.classList.remove("btn-primary");
        }
        // Call function to update Adobe view with the new readOnly value
        updateAdobeView();
    }
    // Set up the event listener for the toggle button
    document.getElementById("enable_editing").addEventListener("click", toggleEditing);
    </script>

{% endblock %}