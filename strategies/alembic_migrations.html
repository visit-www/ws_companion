<h3
id="complete-guide-alembic-migration-setup-and-troubleshooting">Complete
Guide: Alembic Migration Setup and Troubleshooting</h3>
<p>Here’s a structured guide with all the relevant files, steps, and
troubleshooting details, based on what we did to get the migration
working successfully.</p>
<hr />
<h3
id="step-by-step-process-for-alembic-migration-setup"><strong>Step-by-Step
Process for Alembic Migration Setup</strong></h3>
<h4 id="initial-alembic-migration-script"><strong>1. Initial Alembic
Migration Script</strong></h4>
<p>The following script was generated as your initial migration. It
creates the necessary tables for your app, such as <code>users</code>,
<code>contents</code>, <code>user_profiles</code>, and more.</p>
<p><strong>Migration Script</strong>:
<code>migrations/versions/4726a3538ac2_initial_migration.py</code></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;Initial migration</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">Revision ID: 4726a3538ac2</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">Revises: </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">Create Date: 2024-09-22 15:57:05.188541</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Sequence, Union</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> alembic <span class="im">import</span> op</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlalchemy <span class="im">as</span> sa</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># revision identifiers, used by Alembic.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>revision: <span class="bu">str</span> <span class="op">=</span> <span class="st">&#39;4726a3538ac2&#39;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>down_revision: Union[<span class="bu">str</span>, <span class="va">None</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>branch_labels: Union[<span class="bu">str</span>, Sequence[<span class="bu">str</span>], <span class="va">None</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>depends_on: Union[<span class="bu">str</span>, Sequence[<span class="bu">str</span>], <span class="va">None</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> upgrade() <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Table creation commands generated by Alembic.</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    op.create_table(<span class="st">&#39;admin_report_templates&#39;</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        sa.Column(<span class="st">&#39;id&#39;</span>, sa.Integer(), autoincrement<span class="op">=</span><span class="va">True</span>, nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Other fields omitted for brevity...</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        sa.PrimaryKeyConstraint(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_admin_report_templates_body_part&#39;</span>), <span class="st">&#39;admin_report_templates&#39;</span>, [<span class="st">&#39;body_part&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Similarly create other tables, contents, users, user_profiles...</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> downgrade() <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Table removal commands to downgrade migration.</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    op.drop_table(<span class="st">&#39;admin_report_templates&#39;</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Similarly drop other tables...</span></span></code></pre></div>
<hr />
<h4 id="alembic-configuration-file"><strong>2. Alembic Configuration
File</strong></h4>
<p>Ensure your <code>alembic.ini</code> file is correctly set up. Here’s
the configuration:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alembic.ini</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">[alembic]</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">script_location </span><span class="ot">=</span><span class="st"> migrations  # Points to the &#39;migrations&#39; folder</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="dt">sqlalchemy.url </span><span class="ot">=</span><span class="st"> postgresql://admin:811976@localhost/wscdb</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Logging configuration</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">[loggers]</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="dt">keys </span><span class="ot">=</span><span class="st"> root,sqlalchemy,alembic</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="kw">[logger_alembic]</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="dt">level </span><span class="ot">=</span><span class="st"> DEBUG</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="dt">handlers </span><span class="ot">=</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="dt">qualname </span><span class="ot">=</span><span class="st"> alembic</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="kw">[handler_console]</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="dt">class </span><span class="ot">=</span><span class="st"> StreamHandler</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="dt">args </span><span class="ot">=</span><span class="st"> (sys.stderr,)</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="dt">level </span><span class="ot">=</span><span class="st"> NOTSET</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="dt">formatter </span><span class="ot">=</span><span class="st"> generic</span></span></code></pre></div>
<hr />
<h4 id="alembic-env.py-configuration"><strong>3. Alembic
<code>env.py</code> Configuration</strong></h4>
<p>Make sure <code>env.py</code> is properly set up to target your
database and SQLAlchemy models. Below is the refined version we
used:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># migrations/env.py</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> alembic <span class="im">import</span> context</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlalchemy <span class="im">import</span> engine_from_config, pool</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> app.models <span class="im">import</span> Base  <span class="co"># Make sure this is the correct import path for your models</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> context.config</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch the database URL</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>database_url <span class="op">=</span> os.getenv(<span class="st">&quot;DATABASE_URL&quot;</span>, <span class="st">&quot;postgresql://admin:811976@localhost/wscdb&quot;</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle Heroku&#39;s old &#39;postgres://&#39; URL format</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> database_url.startswith(<span class="st">&quot;postgres://&quot;</span>):</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    database_url <span class="op">=</span> database_url.replace(<span class="st">&quot;postgres://&quot;</span>, <span class="st">&quot;postgresql://&quot;</span>, <span class="dv">1</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>config.set_main_option(<span class="st">&quot;sqlalchemy.url&quot;</span>, database_url)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Metadata from your models</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>target_metadata <span class="op">=</span> Base.metadata</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_migrations_online():</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    connectable <span class="op">=</span> engine_from_config(</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        config.get_section(config.config_ini_section),</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        prefix<span class="op">=</span><span class="st">&quot;sqlalchemy.&quot;</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        poolclass<span class="op">=</span>pool.NullPool,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> connectable.<span class="ex">connect</span>() <span class="im">as</span> connection:</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        context.configure(</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>            connection<span class="op">=</span>connection,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>            target_metadata<span class="op">=</span>target_metadata,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> context.begin_transaction():</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>            context.run_migrations()</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> context.is_offline_mode():</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    run_migrations_offline()</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    run_migrations_online()</span></code></pre></div>
<hr />
<h3 id="troubleshooting-steps-we-followed"><strong>Troubleshooting Steps
We Followed</strong></h3>
<p>In case you encounter similar issues in the future, here’s a summary
of the steps we took to resolve the migration not applying properly:</p>
<ol type="1">
<li><strong>Check Alembic Migration History</strong>:
<ul>
<li>Run <code>alembic history</code> to see all applied migrations.</li>
<li>Run <code>alembic current</code> to check the current migration
version.</li>
</ul></li>
<li><strong>Manually Drop the <code>alembic_version</code>
Table</strong> (if stuck):
<ul>
<li><p>If the <code>alembic_version</code> table conflicts, drop it
manually:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> alembic_version;</span></code></pre></div></li>
</ul></li>
<li><strong>Downgrade and Re-apply the Migration</strong>:
<ul>
<li>Run <code>alembic downgrade base</code> to reset the database.</li>
<li>Then, run <code>alembic upgrade head</code> to reapply the
migration.</li>
</ul></li>
<li><strong>Manual Testing with SQLAlchemy</strong>:
<ul>
<li>If necessary, manually test SQLAlchemy’s connection and table
creation using a simple script to ensure the database connection is
valid.</li>
</ul></li>
</ol>
<hr />
<h3 id="future-safeguarding"><strong>Future Safeguarding</strong></h3>
<p>To avoid similar issues in the future:</p>
<ul>
<li><strong>Backup Migration Scripts</strong>: Keep a copy of your
initial migration script and critical database configuration files
(<code>env.py</code>, <code>alembic.ini</code>).</li>
<li><strong>Track Steps</strong>: Record any troubleshooting steps (like
those above) to quickly resolve issues.</li>
</ul>
<hr />
<p>Feel free to copy, save, or use this structured guide as a reference
for future database and migration tasks! Let me know if you need further
assistance or clarification! Here is the full
<code>migrations/versions/4726a3538ac2_initial_migration.py</code>
script with all the tables included. This will serve as the complete
reference for future use.</p>
<h3 id="complete-initial-migration-script">Complete Initial Migration
Script</h3>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;Initial migration</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">Revision ID: 4726a3538ac2</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">Revises: </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">Create Date: 2024-09-22 15:57:05.188541</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Sequence, Union</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> alembic <span class="im">import</span> op</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlalchemy <span class="im">as</span> sa</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># revision identifiers, used by Alembic.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>revision: <span class="bu">str</span> <span class="op">=</span> <span class="st">&#39;4726a3538ac2&#39;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>down_revision: Union[<span class="bu">str</span>, <span class="va">None</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>branch_labels: Union[<span class="bu">str</span>, Sequence[<span class="bu">str</span>], <span class="va">None</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>depends_on: Union[<span class="bu">str</span>, Sequence[<span class="bu">str</span>], <span class="va">None</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> upgrade() <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">###</span><span class="co"> Create admin_report_templates table </span><span class="al">###</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    op.create_table(<span class="st">&#39;admin_report_templates&#39;</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;id&#39;</span>, sa.Integer(), autoincrement<span class="op">=</span><span class="va">True</span>, nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;template_name&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;body_part&#39;</span>, sa.Enum(<span class="st">&#39;NEURO&#39;</span>, <span class="st">&#39;HEAD_AND_NECK&#39;</span>, <span class="st">&#39;ENT&#39;</span>, <span class="st">&#39;PEDIATRICS&#39;</span>, <span class="st">&#39;MSK&#39;</span>, <span class="st">&#39;LUNG&#39;</span>, <span class="st">&#39;CARDIAC&#39;</span>, <span class="st">&#39;ENDOCRINE&#39;</span>, <span class="st">&#39;HEPATOBILIARY&#39;</span>, <span class="st">&#39;UROLOGY&#39;</span>, <span class="st">&#39;GYNAECOLOGY&#39;</span>, <span class="st">&#39;UPPER_GI&#39;</span>, <span class="st">&#39;VASCULAR&#39;</span>, <span class="st">&#39;ONCOLOGY&#39;</span>, <span class="st">&#39;MISCELLANEOUS&#39;</span>, <span class="st">&#39;BREAST&#39;</span>, <span class="st">&#39;OTHERS&#39;</span>, name<span class="op">=</span><span class="st">&#39;body_part_enum&#39;</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;modality&#39;</span>, sa.Enum(<span class="st">&#39;CT&#39;</span>, <span class="st">&#39;X_RAY&#39;</span>, <span class="st">&#39;MRI&#39;</span>, <span class="st">&#39;ULTRASOUND&#39;</span>, <span class="st">&#39;NUCLEAR_MEDICINE&#39;</span>, <span class="st">&#39;MAMMOGRAPHY&#39;</span>, <span class="st">&#39;OTHERS&#39;</span>, name<span class="op">=</span><span class="st">&#39;modality_enum&#39;</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;file&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;filepath&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;tags&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;category&#39;</span>, sa.String(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;module&#39;</span>, sa.Enum(<span class="st">&#39;HEAD_AND_NECK&#39;</span>, <span class="st">&#39;NEURORADIOLOGY&#39;</span>, <span class="st">&#39;CHEST&#39;</span>, <span class="st">&#39;CARDIOVASCULAR&#39;</span>, <span class="st">&#39;BREAST&#39;</span>, <span class="st">&#39;GASTROINTESTINAL&#39;</span>, <span class="st">&#39;ABDOMINAL&#39;</span>, <span class="st">&#39;GENITOURINARY&#39;</span>, <span class="st">&#39;MUSCULOSKELETAL&#39;</span>, <span class="st">&#39;VASCULAR&#39;</span>, <span class="st">&#39;PEDIATRIC&#39;</span>, <span class="st">&#39;ONCOLOGIC&#39;</span>, <span class="st">&#39;EMERGENCY&#39;</span>, <span class="st">&#39;INTERVENTIONAL&#39;</span>, <span class="st">&#39;NUCLEAR_MEDICINE&#39;</span>, <span class="st">&#39;RADIOGRAPHERS&#39;</span>, <span class="st">&#39;OTHERS&#39;</span>, name<span class="op">=</span><span class="st">&#39;module_name&#39;</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;created_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;updated_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    sa.PrimaryKeyConstraint(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_admin_report_templates_body_part&#39;</span>), <span class="st">&#39;admin_report_templates&#39;</span>, [<span class="st">&#39;body_part&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_admin_report_templates_category&#39;</span>), <span class="st">&#39;admin_report_templates&#39;</span>, [<span class="st">&#39;category&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_admin_report_templates_modality&#39;</span>), <span class="st">&#39;admin_report_templates&#39;</span>, [<span class="st">&#39;modality&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_admin_report_templates_module&#39;</span>), <span class="st">&#39;admin_report_templates&#39;</span>, [<span class="st">&#39;module&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_admin_report_templates_template_name&#39;</span>), <span class="st">&#39;admin_report_templates&#39;</span>, [<span class="st">&#39;template_name&#39;</span>], unique<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">###</span><span class="co"> Create contents table </span><span class="al">###</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    op.create_table(<span class="st">&#39;contents&#39;</span>,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;id&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;title&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">565</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;category&#39;</span>, sa.Enum(<span class="st">&#39;GUIDELINES&#39;</span>, <span class="st">&#39;CLASSIFICATIONS&#39;</span>, <span class="st">&#39;DIFFERENTIAL_DIAGNOSIS&#39;</span>, <span class="st">&#39;VETTING_TOOLS&#39;</span>, <span class="st">&#39;ANATOMY&#39;</span>, <span class="st">&#39;CURATED_CONTENTS&#39;</span>, <span class="st">&#39;REPORT_CHECKER&#39;</span>, <span class="st">&#39;RAD_CALCULATORS&#39;</span>, <span class="st">&#39;TNM_STAGING&#39;</span>, <span class="st">&#39;IMAGE_SEARCH&#39;</span>, <span class="st">&#39;PHYSICS&#39;</span>, <span class="st">&#39;GOVERNANCE_AUDITS&#39;</span>, <span class="st">&#39;COURSES&#39;</span>, <span class="st">&#39;RESEARCH_TOOLS&#39;</span>, <span class="st">&#39;MUSIC&#39;</span>, <span class="st">&#39;REPORT_TEMPLATE&#39;</span>, name<span class="op">=</span><span class="st">&#39;category_name&#39;</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;module&#39;</span>, sa.Enum(<span class="st">&#39;HEAD_AND_NECK&#39;</span>, <span class="st">&#39;NEURORADIOLOGY&#39;</span>, <span class="st">&#39;CHEST&#39;</span>, <span class="st">&#39;CARDIOVASCULAR&#39;</span>, <span class="st">&#39;BREAST&#39;</span>, <span class="st">&#39;GASTROINTESTINAL&#39;</span>, <span class="st">&#39;ABDOMINAL&#39;</span>, <span class="st">&#39;GENITOURINARY&#39;</span>, <span class="st">&#39;MUSCULOSKELETAL&#39;</span>, <span class="st">&#39;VASCULAR&#39;</span>, <span class="st">&#39;PEDIATRIC&#39;</span>, <span class="st">&#39;ONCOLOGIC&#39;</span>, <span class="st">&#39;EMERGENCY&#39;</span>, <span class="st">&#39;INTERVENTIONAL&#39;</span>, <span class="st">&#39;NUCLEAR_MEDICINE&#39;</span>, <span class="st">&#39;RADIOGRAPHERS&#39;</span>, <span class="st">&#39;OTHERS&#39;</span>, name<span class="op">=</span><span class="st">&#39;module_name&#39;</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;status&#39;</span>, sa.Enum(<span class="st">&#39;DRAFT&#39;</span>, <span class="st">&#39;PUBLISHED&#39;</span>, <span class="st">&#39;ARCHIVED&#39;</span>, name<span class="op">=</span><span class="st">&#39;status&#39;</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;file&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;filepath&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;external_url&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">2083</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;embed_code&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;keywords&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;language&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">20</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;content_tags&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;importance_level&#39;</span>, sa.Enum(<span class="st">&#39;LOW&#39;</span>, <span class="st">&#39;MEDIUM&#39;</span>, <span class="st">&#39;HIGH&#39;</span>, name<span class="op">=</span><span class="st">&#39;importance_level&#39;</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;featured&#39;</span>, sa.Boolean(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;paid_access&#39;</span>, sa.Boolean(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;api_endpoint&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">2083</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;description&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;version&#39;</span>, sa.Float(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;created_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;updated_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;last_accessed&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;access_count&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;view_duration&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;created_by&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">80</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;file_size&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;estimated_reading_time&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;bookmark_count&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;related_content&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;related_api_links&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;accessibility_features&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    sa.PrimaryKeyConstraint(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_contents_category&#39;</span>), <span class="st">&#39;contents&#39;</span>, [<span class="st">&#39;category&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_contents_content_tags&#39;</span>), <span class="st">&#39;contents&#39;</span>, [<span class="st">&#39;content_tags&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_contents_file&#39;</span>), <span class="st">&#39;contents&#39;</span>, [<span class="st">&#39;file&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_contents_filepath&#39;</span>), <span class="st">&#39;contents&#39;</span>, [<span class="st">&#39;filepath&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_contents_id&#39;</span>), <span class="st">&#39;contents&#39;</span>, [<span class="st">&#39;id&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_contents_keywords&#39;</span>), <span class="st">&#39;contents&#39;</span>, [<span class="st">&#39;keywords&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_contents_module&#39;</span>), <span class="st">&#39;contents&#39;</span>, [<span class="st">&#39;module&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_contents_title&#39;</span>), <span class="st">&#39;contents&#39;</span>, [<span class="st">&#39;title&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">###</span><span class="co"> Create users table </span><span class="al">###</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>    op.create_table(<span class="st">&#39;users&#39;</span>,</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;id&#39;</span>, sa.UUID(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;username&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">150</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;password&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">250</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;email&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">150</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;is_paid&#39;</span>, sa.Boolean(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;is_admin&#39;</span>, sa.Boolean(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;status&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">50</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;created_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>    sa.PrimaryKeyConstraint(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_users_email&#39;</span>), <span class="st">&#39;users&#39;</span>, [<span class="st">&#39;email&#39;</span>], unique<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_users_username&#39;</span>), <span class="st">&#39;users&#39;</span>, [<span class="st">&#39;username&#39;</span>], unique<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">###</span><span class="co"> Create references table </span><span class="al">###</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>    op.create_table(<span class="st">&#39;references&#39;</span>,</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;id&#39;</span>, sa.UUID(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;content_id&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;title&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;category&#39;</span>, sa.Enum(<span class="st">&#39;GUIDELINES&#39;</span>, <span class="st">&#39;CLASSIFICATIONS&#39;</span>, <span class="st">&#39;DIFFERENTIAL_DIAGNOSIS&#39;</span>, <span class="st">&#39;VETTING_TOOLS&#39;</span>, <span class="st">&#39;ANATOMY&#39;</span>, <span class="st">&#39;CURATED_CONTENTS&#39;</span>, <span class="st">&#39;REPORT_CHECKER&#39;</span>, <span class="st">&#39;RAD_CALCULATORS&#39;</span>, <span class="st">&#39;TNM_STAGING&#39;</span>, <span class="st">&#39;IMAGE_SEARCH&#39;</span>, <span class="st">&#39;PHYSICS&#39;</span>, <span class="st">&#39;GOVERNANCE_AUDITS&#39;</span>, <span class="st">&#39;COURSES&#39;</span>, <span class="st">&#39;RESEARCH_TOOLS&#39;</span>, <span class="st">&#39;MUSIC&#39;</span>, <span class="st">&#39;REPORT_TEMPLATE&#39;</span>, name<span class="op">=</span><span class="st">&#39;category_name&#39;</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;module&#39;</span>, sa.Enum(<span class="st">&#39;HEAD_AND_NECK&#39;</span>, <span class="st">&#39;NEURORADIOLOGY&#39;</span>, <span class="st">&#39;CHEST&#39;</span>, <span class="st">&#39;CARDIOVASCULAR&#39;</span>, <span class="st">&#39;BREAST&#39;</span>, <span class="st">&#39;GASTROINTESTINAL&#39;</span>, <span class="st">&#39;ABDOMINAL&#39;</span>, <span class="st">&#39;GENITOURINARY&#39;</span>, <span class="st">&#39;MUSCULOSKELETAL&#39;</span>, <span class="st">&#39;VASCULAR&#39;</span>, <span class="st">&#39;PEDIATRIC&#39;</span>, <span class="st">&#39;ONCOLOGIC&#39;</span>, <span class="st">&#39;EMERGENCY&#39;</span>, <span class="st">&#39;INTERVENTIONAL&#39;</span>, <span class="st">&#39;NUCLEAR_MEDICINE&#39;</span>, <span class="st">&#39;RADIOGRAPHERS&#39;</span>, <span class="st">&#39;OTHERS&#39;</span>, name<span class="op">=</span><span class="st">&#39;module_name&#39;</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;file&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;filepath&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;url&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">2083</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>    sa.Column</span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>(<span class="st">&#39;embed_code&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;description&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;created_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;updated_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>    sa.ForeignKeyConstraint([<span class="st">&#39;content_id&#39;</span>], [<span class="st">&#39;contents.id&#39;</span>], onupdate<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>, ondelete<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>),</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>    sa.PrimaryKeyConstraint(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_references_category&#39;</span>), <span class="st">&#39;references&#39;</span>, [<span class="st">&#39;category&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_references_file&#39;</span>), <span class="st">&#39;references&#39;</span>, [<span class="st">&#39;file&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_references_module&#39;</span>), <span class="st">&#39;references&#39;</span>, [<span class="st">&#39;module&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">###</span><span class="co"> Create user_content_states table </span><span class="al">###</span></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>    op.create_table(<span class="st">&#39;user_content_states&#39;</span>,</span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;id&#39;</span>, sa.UUID(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;content_id&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;user_id&#39;</span>, sa.UUID(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;modified_filepath&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;annotations&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;created_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;updated_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>    sa.ForeignKeyConstraint([<span class="st">&#39;content_id&#39;</span>], [<span class="st">&#39;contents.id&#39;</span>], onupdate<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>, ondelete<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>),</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>    sa.ForeignKeyConstraint([<span class="st">&#39;user_id&#39;</span>], [<span class="st">&#39;users.id&#39;</span>], onupdate<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>, ondelete<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>),</span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>    sa.PrimaryKeyConstraint(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">###</span><span class="co"> Create user_data table </span><span class="al">###</span></span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>    op.create_table(<span class="st">&#39;user_data&#39;</span>,</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;id&#39;</span>, sa.UUID(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;user_id&#39;</span>, sa.UUID(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;content_id&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;interaction_type&#39;</span>, sa.Enum(<span class="st">&#39;viewed&#39;</span>, <span class="st">&#39;bookmarked&#39;</span>, <span class="st">&#39;recommended&#39;</span>, <span class="st">&#39;registered&#39;</span>, <span class="st">&#39;logged_in&#39;</span>, <span class="st">&#39;logged_out&#39;</span>, <span class="st">&#39;updated_profile_pic&#39;</span>, <span class="st">&#39;updated_username&#39;</span>, <span class="st">&#39;updated_email&#39;</span>, <span class="st">&#39;updated_report_templates&#39;</span>, <span class="st">&#39;updated_category_module_preferences&#39;</span>, <span class="st">&#39;updated_contents&#39;</span>, <span class="st">&#39;added_feedback&#39;</span>, name<span class="op">=</span><span class="st">&#39;interaction_types&#39;</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;last_interaction&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;feedback&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;content_rating&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;time_spent&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;last_login&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;current_login&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;session_start_time&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;login_count&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>    sa.ForeignKeyConstraint([<span class="st">&#39;content_id&#39;</span>], [<span class="st">&#39;contents.id&#39;</span>], onupdate<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>, ondelete<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>),</span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>    sa.ForeignKeyConstraint([<span class="st">&#39;user_id&#39;</span>], [<span class="st">&#39;users.id&#39;</span>], onupdate<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>, ondelete<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>),</span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>    sa.PrimaryKeyConstraint(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">###</span><span class="co"> Create user_feedbacks table </span><span class="al">###</span></span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a>    op.create_table(<span class="st">&#39;user_feedbacks&#39;</span>,</span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;id&#39;</span>, sa.UUID(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;user_id&#39;</span>, sa.UUID(), server_default<span class="op">=</span><span class="st">&#39;123e4567-e89b-12d3-a456-426614174000&#39;</span>, nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;content_id&#39;</span>, sa.Integer(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;feedback&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;is_public&#39;</span>, sa.Boolean(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;user_display_name&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">100</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;created_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;updated_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>    sa.ForeignKeyConstraint([<span class="st">&#39;content_id&#39;</span>], [<span class="st">&#39;contents.id&#39;</span>], onupdate<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>),</span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>    sa.ForeignKeyConstraint([<span class="st">&#39;user_id&#39;</span>], [<span class="st">&#39;users.id&#39;</span>], onupdate<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>, ondelete<span class="op">=</span><span class="st">&#39;SET DEFAULT&#39;</span>),</span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>    sa.PrimaryKeyConstraint(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">###</span><span class="co"> Create user_profiles table </span><span class="al">###</span></span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>    op.create_table(<span class="st">&#39;user_profiles&#39;</span>,</span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;id&#39;</span>, sa.UUID(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;user_id&#39;</span>, sa.UUID(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;profile_pic&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;profile_pic_path&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;preferred_categories&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;preferred_modules&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;created_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;updated_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>    sa.ForeignKeyConstraint([<span class="st">&#39;user_id&#39;</span>], [<span class="st">&#39;users.id&#39;</span>], onupdate<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>, ondelete<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>),</span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>    sa.PrimaryKeyConstraint(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">###</span><span class="co"> Create user_report_templates table </span><span class="al">###</span></span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>    op.create_table(<span class="st">&#39;user_report_templates&#39;</span>,</span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;id&#39;</span>, sa.Integer(), autoincrement<span class="op">=</span><span class="va">True</span>, nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;body_part&#39;</span>, sa.Enum(<span class="st">&#39;NEURO&#39;</span>, <span class="st">&#39;HEAD_AND_NECK&#39;</span>, <span class="st">&#39;ENT&#39;</span>, <span class="st">&#39;PEDIATRICS&#39;</span>, <span class="st">&#39;MSK&#39;</span>, <span class="st">&#39;LUNG&#39;</span>, <span class="st">&#39;CARDIAC&#39;</span>, <span class="st">&#39;ENDOCRINE&#39;</span>, <span class="st">&#39;HEPATOBILIARY&#39;</span>, <span class="st">&#39;UROLOGY&#39;</span>, <span class="st">&#39;GYNAECOLOGY&#39;</span>, <span class="st">&#39;UPPER_GI&#39;</span>, <span class="st">&#39;VASCULAR&#39;</span>, <span class="st">&#39;ONCOLOGY&#39;</span>, <span class="st">&#39;MISCELLANEOUS&#39;</span>, <span class="st">&#39;BREAST&#39;</span>, <span class="st">&#39;OTHERS&#39;</span>, name<span class="op">=</span><span class="st">&#39;body_part_enum&#39;</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;modality&#39;</span>, sa.Enum(<span class="st">&#39;CT&#39;</span>, <span class="st">&#39;X_RAY&#39;</span>, <span class="st">&#39;MRI&#39;</span>, <span class="st">&#39;ULTRASOUND&#39;</span>, <span class="st">&#39;NUCLEAR_MEDICINE&#39;</span>, <span class="st">&#39;MAMMOGRAPHY&#39;</span>, <span class="st">&#39;OTHERS&#39;</span>, name<span class="op">=</span><span class="st">&#39;modality_enum&#39;</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;template_name&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;tags&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;is_public&#39;</span>, sa.Boolean(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;user_id&#39;</span>, sa.UUID(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;category&#39;</span>, sa.Enum(<span class="st">&#39;GUIDELINES&#39;</span>, <span class="st">&#39;CLASSIFICATIONS&#39;</span>, <span class="st">&#39;DIFFERENTIAL_DIAGNOSIS&#39;</span>, <span class="st">&#39;VETTING_TOOLS&#39;</span>, <span class="st">&#39;ANATOMY&#39;</span>, <span class="st">&#39;CURATED_CONTENTS&#39;</span>, <span class="st">&#39;REPORT_CHECKER&#39;</span>, <span class="st">&#39;RAD_CALCULATORS&#39;</span>, <span class="st">&#39;TNM_STAGING&#39;</span>, <span class="st">&#39;IMAGE_SEARCH&#39;</span>, <span class="st">&#39;PHYSICS&#39;</span>, <span class="st">&#39;GOVERNANCE_AUDITS&#39;</span>, <span class="st">&#39;COURSES&#39;</span>, <span class="st">&#39;RESEARCH_TOOLS&#39;</span>, <span class="st">&#39;MUSIC&#39;</span>, <span class="st">&#39;REPORT_TEMPLATE&#39;</span>, name<span class="op">=</span><span class="st">&#39;category_name&#39;</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;module&#39;</span>, sa.Enum(<span class="st">&#39;HEAD_AND_NECK&#39;</span>, <span class="st">&#39;NEURORADIOLOGY&#39;</span>, <span class="st">&#39;CHEST&#39;</span>, <span class="st">&#39;CARDIOVASCULAR&#39;</span>, <span class="st">&#39;BREAST&#39;</span>, <span class="st">&#39;GASTROINTESTINAL&#39;</span>, <span class="st">&#39;ABDOMINAL&#39;</span>, <span class="st">&#39;GENITOURINARY&#39;</span>, <span class="st">&#39;MUSCULOSKELETAL&#39;</span>, <span class="st">&#39;VASCULAR&#39;</span>, <span class="st">&#39;PEDIATRIC&#39;</span>, <span class="st">&#39;ONCOLOGIC&#39;</span>, <span class="st">&#39;EMERGENCY&#39;</span>, <span class="st">&#39;INTERVENTIONAL&#39;</span>, <span class="st">&#39;NUCLEAR_MEDICINE&#39;</span>, <span class="st">&#39;RADIOGRAPHERS&#39;</span>, <span class="st">&#39;OTHERS&#39;</span>, name<span class="op">=</span><span class="st">&#39;module_name&#39;</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;template_text&#39;</span>, sa.Text(), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;file&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;filepath&#39;</span>, sa.String(length<span class="op">=</span><span class="dv">255</span>), nullable<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;created_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a>    sa.Column(<span class="st">&#39;updated_at&#39;</span>, sa.DateTime(), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a>    sa.ForeignKeyConstraint([<span class="st">&#39;user_id&#39;</span>], [<span class="st">&#39;users.id&#39;</span>], onupdate<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>, ondelete<span class="op">=</span><span class="st">&#39;CASCADE&#39;</span>),</span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a>    sa.PrimaryKeyConstraint(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_user_report_templates_body_part&#39;</span>), <span class="st">&#39;user_report_templates&#39;</span>, [<span class="st">&#39;body_part&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_user_report_templates_category&#39;</span>), <span class="st">&#39;user_report_templates&#39;</span>, [<span class="st">&#39;category&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_user_report_templates_is_public&#39;</span>), <span class="st">&#39;user_report_templates&#39;</span>, [<span class="st">&#39;is_public&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_user_report_templates_modality&#39;</span>), <span class="st">&#39;user_report_templates&#39;</span>, [<span class="st">&#39;modality&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_user_report_templates_module&#39;</span>), <span class="st">&#39;user_report_templates&#39;</span>, [<span class="st">&#39;module&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_user_report_templates_template_name&#39;</span>), <span class="st">&#39;user_report_templates&#39;</span>, [<span class="st">&#39;template_name&#39;</span>], unique<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a>    op.create_index(op.f(<span class="st">&#39;ix_user_report_templates_user_id&#39;</span>), <span class="st">&#39;user_report_templates&#39;</span>, [<span class="st">&#39;user_id&#39;</span>], unique<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> downgrade() <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Downgrade actions, drop the tables</span></span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a>    op.drop_index(op.f(<span class="st">&#39;ix_user_report_templates_user_id&#39;</span>), table_name<span class="op">=</span><span class="st">&#39;user_report_templates&#39;</span>)</span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a>    op.drop_index(op.f(<span class="st">&#39;ix_user_report_templates_template_name&#39;</span>), table_name<span class="op">=</span><span class="st">&#39;user_report_templates&#39;</span>)</span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a>    op.drop_index(op.f(<span class="st">&#39;ix_user_report_templates_module&#39;</span>), table_name<span class="op">=</span><span class="st">&#39;user_report_templates&#39;</span>)</span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a>    op.drop_index(op.f(<span class="st">&#39;ix_user_report_templates_modality&#39;</span>), table_name<span class="op">=</span><span class="st">&#39;user_report_templates&#39;</span>)</span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a>    op.drop_index(op.f(<span class="st">&#39;ix_user_report_templates_is_public&#39;</span>), table_name<span class="op">=</span><span class="st">&#39;user_report_templates&#39;</span>)</span>
<span id="cb5-218"><a href="#cb5-218" aria-hidden="true" tabindex="-1"></a>    op.drop_index(op.f(<span class="st">&#39;ix_user_report_templates_category&#39;</span>), table_name<span class="op">=</span><span class="st">&#39;user_report_templates&#39;</span>)</span>
<span id="cb5-219"><a href="#cb5-219" aria-hidden="true" tabindex="-1"></a>    op.drop_index(op.f(<span class="st">&#39;ix_user_report_templates_body_part&#39;</span>), table_name<span class="op">=</span><span class="st">&#39;user_report_templates&#39;</span>)</span>
<span id="cb5-220"><a href="#cb5-220" aria-hidden="true" tabindex="-1"></a>    op.drop_table(<span class="st">&#39;user_report_templates&#39;</span>)</span>
<span id="cb5-221"><a href="#cb5-221" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Repeat for other tables...</span></span>
<span id="cb5-222"><a href="#cb5-222" aria-hidden="true" tabindex="-1"></a>    op.drop_table(<span class="st">&#39;user_profiles&#39;</span>)</span>
<span id="cb5-223"><a href="#cb5-223" aria-hidden="true" tabindex="-1"></a>    op.drop_table(<span class="st">&#39;user_feedbacks&#39;</span>)</span>
<span id="cb5-224"><a href="#cb5-224" aria-hidden="true" tabindex="-1"></a>    op.drop_table(<span class="st">&#39;user_data&#39;</span>)</span>
<span id="cb5-225"><a href="#cb5-225" aria-hidden="true" tabindex="-1"></a>    op.drop_table(<span class="st">&#39;user_content_states&#39;</span>)</span>
<span id="cb5-226"><a href="#cb5-226" aria-hidden="true" tabindex="-1"></a>    op.drop_table(<span class="st">&#39;references&#39;</span>)</span>
<span id="cb5-227"><a href="#cb5-227" aria-hidden="true" tabindex="-1"></a>    op.drop_table(<span class="st">&#39;users&#39;</span>)</span>
<span id="cb5-228"><a href="#cb5-228" aria-hidden="true" tabindex="-1"></a>    op.drop_table(<span class="st">&#39;contents&#39;</span>)</span>
<span id="cb5-229"><a href="#cb5-229" aria-hidden="true" tabindex="-1"></a>    op.drop_table(<span class="st">&#39;admin_report_templates&#39;</span>)</span></code></pre></div>
<p>This is the full initial migration script containing all the tables
and their respective fields. You can save this script for future
reference or troubleshooting if needed.</p>
<p>Let me know if you need any more adjustments!</p>
